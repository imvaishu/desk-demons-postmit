mixin post(post)
  div(class=`post ${post.parentPost ? 'parent-response' : post.childPost ? 'response' : ''}` id=`post-${post.postId}` onclick=`expandPost(${post.postId})`)
    if post.repostedBy
     - let name = post.repostedBy===loggedUser ? 'me' : post.repostedBy;
     .row
       .username!= `Reposted by <a class="link" href="/user/${name}">@${name}</a>`
    .row
      .user-info
        .profile-pic
          if post.imageUrl
            img(src=post.imageUrl)
          else 
            span.center= post.initials
        .user-details
          .name
            a.link(href=`/user/${post.username}`)= post.name 
            a(class="timestamp" data-time=post.postedAt)= ` ãƒ» ${post.postedAt}`
          .username
            a.link(href=`/user/${post.username}`)= `@${post.username}`
      if post.isDeletable
        .icon(onclick=`showDeletePostPopup(${post.postId})`)
          i.fas.fa-trash.highlight-red
    if post.replyingTo&&post.replyingTo!=post.username
      .row
        .username!= `Replying to <a class="link" href="/user/${post.replyingTo}">@${post.replyingTo}</a>`
    .row
      .content
        each line in post.message.split(/\n/)
          - let urlRegEx= /(https?:\/\/[^\s]+)/g;
          - let replacedLine= line.replace(/</g,'&lt;').replace(/>/g,'&gt;')
          - replacedLine= post.mentions.reduce((line,user) => line.replace(new RegExp(`@\\b${user}\\b`),`<a class="highlight-link" href="/user/${user}">@${user}</a>`),replacedLine) 
          - replacedLine= post.hashtags.reduce((line,hashtag) => line.replace(new RegExp(`#\\b${hashtag}\\b`),`<a class="highlight-link" href="/hashtag/${hashtag}">#${hashtag}</a>`),replacedLine) 
          - replacedLine= replacedLine.replace(urlRegEx,(url)=>`<a class="highlight-link" href="${url}">${url}</a>`)
          != replacedLine
          br
    .row.actions
      .action.icon.highlight-blue(onClick=`replyToPost(${post.postId})`)
        i.far.fa-comment
        span(class=`count ${post.responseCount ? '' : 'hide-count'}`)= post.responseCount
      div(class=`action icon ${post.isLiked ? 'fill-red' : 'highlight-red'}` onclick=`toggleLikeUnlike(${post.postId})`)
        i(class=`${post.isLiked ? 'fas' : 'far'} fa-heart`)
        span(class=`count ${post.likedUsers.length ? '' : 'hide-count'}`)= post.likedUsers.length
      div(class=`action icon highlight-blue` onclick=`toggleRepost(${post.postId})`)
        i(class="fas fa-retweet")
        span(class=`count ${post.repostCount ? '' : 'hide-count'}`)= post.repostCount
      div(class=`action icon ${post.isBookmarked ? 'fill-blue' : 'highlight-blue'}` onclick=`toggleBookmark(${post.postId})`)
        i(class=`${post.isBookmarked ? 'fas' : 'far'} fa-bookmark`)
